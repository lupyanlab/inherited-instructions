---
title: Inherited knowledge
output:
  bookdown::pdf_document2:
    toc: no
---
```{r config, include=FALSE}
library(knitr)
opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE, cache=TRUE)
read_chunk("R/inherited-instructions.R")

library(patchwork)
library(pander)
panderOptions("table.alignment.default", "left")

library(lme4)
library(AICcmodavg)
```
```{r inherited-instructions, include=FALSE}
```

# Introduction

## Research question

Can individuals pass on knowledge via language that enables future generations
to exceed previous generations?

# Methods

## Procedure

On each trial, participants see 6 gabor patches ("gems") that vary in
orientation and bar width and they select the one they think is most valuable.

Unbeknownst to the participants, the 6 gabors they see on each trial
are sampled from within a certain radius in stimulus space of their last
trial.

Participants are assigned to Generation 1 or Generation 2.

- Generation 1 participants complete 2 blocks, then they type out instructions
  for the next generation, then they complete 2 more blocks.
- Generation 2 participants read the instructions from Generation 1, then
  complete 4 blocks.

# Results

```{r results, fig.width=8, fig.height=8}
positions_plot + scores_plot + distance_plot + plot_layout(nrow = 3)
```

```{r final, fig.width=6}
final_scores_plot + final_distances_plot
```

## Instructions

```{r gen1-gen2-instructions}
InstructionsGen1 <- Instructions %>%
  filter(version == 1.2, generation == 1) %>%
  select(-version, -generation)

InstructionsGen2 <- Instructions %>%
  filter(version == 1.2, generation == 2) %>%
  left_join(inheritance_map) %>%
  select(-version, -generation)

left_join(InstructionsGen1, InstructionsGen2, by = c("subj_id" = "inherit_from"), suffix = c("_gen1", "_gen2")) %>%
  pander(split.cells = c(5, 25, 5, 25))
```

## Survey

### Predictability

```{r predictability, fig.width=8}
predictable_plot <- ggplot(Survey) +
  aes(generation_f, predictable) +
  geom_bar(aes(fill = generation_f, width = 0.8),
           stat = "summary", fun.y = "mean",
           alpha = 0.4) +
  geom_point(aes(color = generation_f),
             position = position_jitter(width = 0.1, height = 0.1)) +
  labs(title = "How predictable or random did you\nfeel the values of the gems were?") +
  coord_cartesian(xlim = c(0, 3), ylim = c(0.9, 5.1), expand = FALSE) +
  theme(legend.position = "none")

subj_predictabilities <- select(Survey, subj_id, predictable)

predictable_final_plot <- ggplot(left_join(GemsFinal, subj_predictabilities)) +
  aes(predictable, score) +
  geom_point(aes(color = generation_f), position = position_jitter(width = 0.1, height = 0)) +
  geom_smooth(method = "lm", color = NA)

predictable_plot + predictable_final_plot + plot_layout(nrow = 1)
```

### Effort

```{r effort, fig.width=4}
effort_plot <- ggplot(Survey) +
  aes(generation_f, effort) +
  geom_bar(aes(fill = generation_f, width = 0.8),
           stat = "summary", fun.y = "mean",
           alpha = 0.4) +
  geom_point(aes(color = generation_f),
             position = position_jitter(width = 0.1, height = 0.1)) +
  labs(title = "Please rate your overall effort\nin this experiment.") +
  coord_cartesian(xlim = c(0, 3), ylim = c(0.9, 5.1), expand = FALSE) +
  theme(legend.position = "none")

effort_plot
```

## Hypotheses

\newpage

### H1

_How does the performance of Generation 1 participants in blocks 1 and 2
compare to the performance of Generation 2 participants in blocks 1 and 2?_

Generation 2, having benefitted from the instructions left by
Generation 1, will exceed the performance of Generation 2 in the
first two blocks.

```{r first-blocks}
FirstBlocks <- Gems %>%
  filter(block_ix %in% 1:2) %>%
  recode_trial()

first_blocks_mod <- lmer(score ~ (trial_z + trial_z_sqr) * generation_c + (trial_z + trial_z_sqr|subj_id),
                         data = FirstBlocks)

first_blocks_preds <- expand.grid(trial = 0:40, generation_c = c(-0.5, 0.5)) %>%
  recode_trial() %>%
  cbind(., predictSE(first_blocks_mod, newdata = ., se = TRUE)) %>%
  rename(score = fit, se = se.fit) %>%
  recode_generation()

ggplot(FirstBlocks) +
  aes(trial, score) +
  geom_point(aes(color = generation_f),
             stat = "summary", fun.y = "mean") +
  geom_smooth(aes(ymin = score - se, ymax = score + se, color = generation_f),
              stat = "identity", data = first_blocks_preds)
```

\newpage

### H2

_How does the performance of Generation 1 participants in blocks 3 and 4
compare to the performance of Generation 2 participants in blocks 1 and 2?_

Generation 2 will benefit from the instructions left by Generation 1 in blocks 1 and 2
more than Generation 1 in blocks 3 and 4.

```{r post-instructions}
PostInstructions <- Gems %>%
  filter((generation == 1 & block_ix %in% c(3, 4)) | (generation == 2 & block_ix %in% c(1, 2))) %>%
  recode_trial()

post_instructions_mod <- lmer(score ~ (trial_z + trial_z_sqr) * generation_c + (trial_z + trial_z_sqr|subj_id),
                              data = PostInstructions)

post_instructions_preds <- expand.grid(trial = 0:40, generation_c = c(-0.5, 0.5)) %>%
  recode_trial() %>%
  cbind(., predictSE(post_instructions_mod, newdata = ., se = TRUE)) %>%
  rename(score = fit, se = se.fit) %>%
  recode_generation()

ggplot(PostInstructions) +
  aes(trial, score) +
  geom_point(aes(color = generation_f),
             stat = "summary", fun.y = "mean") +
  geom_smooth(aes(ymin = score - se, ymax = score + se, color = generation_f),
              stat = "identity", data = post_instructions_preds)
```